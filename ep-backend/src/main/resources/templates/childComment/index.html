<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sd="http://www.thymeleaf.org/spring-data"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
>
<head th:replace="~{fragments/header :: common_header}">

</head>
<header>
    <th:block layout:fragment="links">

    </th:block>
</header>
<body>
<div>
    <div class="col-lg-12">

        <div class="panel">
            <div class="panel-heading">

            </div>
            <div class="panel-heading" style=" padding: 15px 15px 5px">
                <form class="form-inline" id="query-form" role="form">
                    <div class="form-group">
                        <input type="text" class="form-control " name="courseName" th:value="${map.get('courseName')}"
                               placeholder="课程">
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control " name="className" th:value="${map.get('className')}"
                               placeholder="班次">
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control " name="classCatalogTitle" th:value="${map.get('classCatalogTitle')}"
                               placeholder="班次目录">
                    </div>


                    <div class="form-group ">
                        <select class="form-control" name="status" id="type" style="width:182px;">
                            <option value>类型</option>
                            <option th:each="state : ${T(com.ep.domain.repository.domain.enums.EpMemberChildCommentType).values()}"
                                    th:value="${state}"
                                    th:selected="${#stringTools.equals(state,map.get('type'))}"
                                    th:text="#{EpMemberChildCommentType.+${state.literal}}">
                            </option>
                        </select>
                    </div>
                    <!--<div class="form-group mr10">-->
                    <!--<div class="input-group input-large">-->
                    <!--<input type="text" class="form-control  startTime" name="crStartTime" id="crStartTime"-->
                    <!--th:placeholder="创建时间从" th:value="${map.get('crStartTime')}"-->
                    <!--&gt;-->
                    <!--<span class="input-group-addon">到</span>-->
                    <!--<input type="text" class="form-control  endTime" name="crEndTime" id="crEndTime"-->
                    <!--th:placeholder="到" th:value="${map.get('crEndTime')}"-->
                    <!--&gt;-->
                    <!--</div>-->
                    <!--</div>-->


                    <div class="form-group" style="vertical-align: top;">
                        <button class="btn btn-primary" id="query-button" type="button">查询</button>
                        <button class="btn btn-warning" id="rest-button" type="button">重置</button>
                    </div>

                </form>

            </div>
            <div class="panel-body">

                <div id="editable_wrapper" class="dataTables_wrapper form-inline" role="grid"
                     sd:page-object="${page}">
                    <!--Userlist start-->
                    <table class="table table-striped table-hover table-bordered dataTable" id="editable"
                           aria-describedby="editable_info">
                        <thead>
                        <tr>
                            <th><a class="sorted" sd:pagination-sort="id">ID</a></th>
                            <th>姓名</th>
                            <th>课程</th>
                            <th>班次</th>
                            <th>班次目录</th>
                            <th style="width:350px">内容</th>
                            <th>父级</th>
                            <th>类型</th>
                            <th>创建时间</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="tbody">
                        <tr th:each="bo:${page.content}">
                            <td th:text="${bo.id}"></td>
                            <td th:text="${bo.childTrueName}"></td>
                            <td th:text="${bo.courseName}"></td>
                            <td th:text="${bo.className}"></td>
                            <td th:text="${bo.classCatalogTitle}"></td>
                            <td name="content" th:text="${bo.content}"></td>
                            <td th:text="${bo.pId}"></td>
                            <td th:text="#{EpMemberChildCommentType.+${bo.type}}"></td>
                            <td th:text="${bo.createAt}"></td>
                            <td name="button">
                                <a class="btn btn-xs btn-info" th:if="${#stringTools.equals(bo.type,'launch')}"
                                   href="javascript:void(0)"
                                   th:onclick="'updateContentBox(this,'+${bo.id}+')'">修改内容</a>
                                <a class="btn btn-xs btn-danger" th:if="${#stringTools.equals(bo.type,'launch')}"
                                   href="javascript:void(0)"
                                   th:onclick="'findReplyBox('+${bo.id}+')'">查看回复</a>

                            </td>

                        </tr>
                        </tbody>
                    </table>
                    <!--Userlist end-->

                    <div class="row mt15">
                        <div class="col-lg-6">
                            <label class="fl" sd:page-size-selector="dropdown">
                                <select size="1" name="editable-sample_length" aria-controls="editable-sample"
                                        class="form-control xsmall" sd:page-size-selector="default">

                                </select>
                            </label>
                            <span class="fl pl15 pt10" sd:pagination-summary=""></span>
                        </div>

                        <div class="col-lg-6">
                            <ul class="pagination pagination-sm pull-right" sd:pagination="full">

                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal inmodal" id="uploadModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated bounceInRight">

            <input type="hidden" id="sourceId">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                        class="sr-only">关闭</span>
                </button>
                <h3 style="text-align: left">修改评价</h3>

            </div>
            <div class="modal-body">
                <label>内容：</label>
                <textarea class="form-control" id="content"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" onclick="updateContentDo()">保存</button>
            </div>

        </div>
    </div>
</div>
<div class="modal inmodal fade" id="replyModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                        class="sr-only">Close</span></button>
                <h3 class="modal-title">回复记录</h3>
            </div>
            <div class="modal-body">
                <table class="table table-striped table-hover table-bordered dataTable" id=""
                       aria-describedby="editable_info">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>姓名</th>
                        <th>课程</th>
                        <th>班次</th>
                        <th>班次目录</th>
                        <th style="width:350px">内容</th>
                        <th>父级</th>
                        <th>创建时间</th>
                    </tr>
                    </thead>
                    <tbody id="replyListBox">

                    </tbody>
                </table>

            </div>
        </div>
    </div>
</div>
<script type="text/template" id='replyTmpl'>
    <tr>
        <td>${id}</td>
        <td>${childTrueName}</td>
        <td>${courseName}</td>
        <td>${className}</td>
        <td>${classCatalogTitle}</td>
        <td>${content}</td>
        <td>${pid}</td>
        <td>${createAt}</td>
    </tr>
</script>
<script th:replace="~{fragments/scripts}"></script>
<script th:src="@{/js/jquery.tmpl.min.js}"></script>

<script>
    function findReplyBox(pid) {
        $("#replyModal").modal("show")
        $.ajax({
            type: "GET",
            url: "/auth/childComment/findReplyByPid/" + pid,
            success: function (data) {
                if (data.success) {
                    var replyList = data.result
                    console.log(replyList)
                    $("#replyListBox").html($("#replyTmpl").tmpl(replyList));
                }
            }
        })
    }
    function updateContentBox(ele, id) {
        $("#uploadModal").modal("show")
        var content = $(ele).parent().siblings("td[name='content']").eq(0).html()
        $("#content").text(content)
        $("#sourceId").val(id)
    }
    function updateContentDo() {
        $.ajax({
            type: "POST",
            url: "/auth/childComment/updateContent",
            data: {id: $("#sourceId").val(), content: $("#content").val()},
            success: function (data) {
                if (data.success) {
                    toastr_success(null, "/auth/childComment/index")
                } else {
                    toastr_error(null, "/auth/childComment/index")
                }
            }
        })
    }

//    $(function () {
//        console.log([[${page}]]);
//    })

</script>
</body>
</html>