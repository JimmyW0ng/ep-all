<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sd="http://www.thymeleaf.org/spring-data"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
>
<head th:replace="~{fragments/header :: common_header}">

</head>
<header>
    <th:block layout:fragment="links">

    </th:block>
</header>
<body>
<div>
    <div class="col-lg-12">

        <!--<div class="panel">-->

        <!--&lt;!&ndash;<div class="panel-heading">&ndash;&gt;-->
        <!--&lt;!&ndash;<a class="btn btn-success" type="button" th:href="@{/auth/user/createInit}"><i&ndash;&gt;-->
        <!--&lt;!&ndash;class="glyphicon glyphicon-plus"></i> 创建</a>&ndash;&gt;-->
        <!--&lt;!&ndash;</div>&ndash;&gt;-->
        <!--<div class="panel-heading" style=" padding: 15px 15px 5px">-->
        <!--<form class="form-inline" id="query-form" role="form">-->

        <!--<div class="form-group">-->
        <!--<select type="text" class="form-control" name="catalogId" id="catalogId" style="width:182px;">-->
        <!--<option value="">类目</option>-->
        <!--<option th:each="po :${constantCatalogPos}" th:value="${po.id}" th:text="${po.label}"></option>-->
        <!--</select>-->
        <!--</div>-->

        <!--<div class="form-group" style="vertical-align: top;">-->
        <!--<button class="btn btn-primary" onclick="findTags()" type="button">查询</button>-->
        <!--</div>-->

        <!--</form>-->


        <!--</div>-->
        <!--<div class="panel-body">-->
        <!--<div style="background: #eee;min-height: 500px;padding: 20px 0px">-->
        <!--<div class="col-sm-3">-->
        <!--<input id="createTag" name="" type="text" class="form-control" placeholder="标签名">-->
        <!--</div>-->
        <!--<div class="col-sm-3">-->
        <!--<button class="btn btn-primary " type="button" onclick="createTagBox()">创 建</button>-->
        <!--</div>-->
        <!--<div  class="col-sm-12" style="padding-top: 20px">-->
        <!--<label class="col-sm-2" >公用标签：</label>-->
        <!--<div id="constantTagBox"></div>-->
        <!--</div>-->
        <!--<div  class="col-sm-12" style="padding-top: 20px">-->
        <!--<label class="col-sm-2" >我的标签：</label>-->
        <!--<div id="createTagBox"></div>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->


        <div class="panel">
            <div class="panel-heading">
                <a class="btn btn-success" type="button" href="javascript:void(0)" onclick="createInit('新增标签')"><i
                        class="glyphicon glyphicon-plus"></i> 新增</a>
            </div>

            <div class="panel-heading" style=" padding: 15px 15px 5px">
                <form class="form-inline" id="query-form" role="form">
                    <!--<div class="form-group">-->
                    <!--<input type="text" class="form-control "-->
                    <!--name="courseName" th:value="${searchMap.get('courseName')}"-->
                    <!--placeholder="产品名称">-->
                    <!--</div>-->

                    <!--<div class="form-group ">-->
                    <!--<select class="form-control" name="courseType" id="courseType" style="width:182px;">-->
                    <!--<option value>类型</option>-->
                    <!--<option th:each="state : ${T(com.ep.domain.repository.domain.enums.EpOrganCourseCourseType).values()}"-->
                    <!--th:value="${state}"-->
                    <!--th:selected="${#stringTools.equals(state,searchMap.get('courseType'))}"-->
                    <!--th:text="#{EpOrganCourseCourseType.+${state.literal}}">-->
                    <!--</option>-->
                    <!--</select>-->
                    <!--</div>-->
                    <div class="form-group mr10">
                        <div class="input-group input-large">
                            <input type="text" class="form-control  startTime" name="crStartTime" id="crStartTime"
                                   th:value="${searchMap.get('crStartTime')}"
                                   th:placeholder="创建时间从"
                            >
                            <span class="input-group-addon">到</span>
                            <input type="text" class="form-control  endTime" name="crEndTime" id="crEndTime"
                                   th:value="${searchMap.get('crEndTime')}"
                                   th:placeholder="到"
                            >
                        </div>
                    </div>


                    <div class="form-group" style="vertical-align: top;">
                        <button class="btn btn-primary" id="query-button" type="button">查询</button>
                        <button class="btn btn-warning" id="rest-button" type="button">重置</button>
                    </div>

                </form>
            </div>
            <div class="panel-body">

                <div id="editable_wrapper" class="dataTables_wrapper form-inline" role="grid"
                     sd:page-object="${page}">
                    <!--Userlist start-->
                    <table class="table table-striped table-hover table-bordered dataTable" id="editable"
                           aria-describedby="editable_info">
                        <thead>
                        <tr>
                            <th><a class="sorted" sd:pagination-sort="id">ID</a></th>
                            <th>标签</th>
                            <th>等级</th>
                            <th>排序</th>
                            <th>创建时间</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="po:${page.content}">
                            <td th:text="${po.id}"></td>
                            <td><span class="label ogn-tag" th:text="${po.tagName}"></span></td>
                            <td th:text="${po.tagLevel}"></td>
                            <td th:text="${po.sort}"></td>

                            <td th:text="${#dates.format(po.createAt,'yyyy-MM-dd HH:mm:ss')}"></td>
                            <td>
                                <!--<a class="btn btn-xs btn-info"-->
                                <!--th:href="@{/auth/organCourse/merchantview/}+${bo.id}">查看</a>-->
                                <!--<a class="btn btn-xs btn-primary" th:href="@{/auth/organAccount/updateInit/}+${bo.id}">修改</a>-->
                                <a class="btn btn-xs btn-danger" href="javascript:void(0)" th:if="!${po.usedFlag}"
                                   th:onclick="'deleteBox('+${po.id}+')'">删除</a>

                            </td>

                        </tr>
                        </tbody>
                    </table>
                    <!--Userlist end-->

                    <div class="row mt15">
                        <div class="col-lg-6">
                            <label class="fl" sd:page-size-selector="dropdown">
                                <select size="1" name="editable-sample_length" aria-controls="editable-sample"
                                        class="form-control xsmall" sd:page-size-selector="default">

                                </select>
                            </label>
                            <span class="fl pl15 pt10" sd:pagination-summary=""></span>
                        </div>

                        <div class="col-lg-6">
                            <ul class="pagination pagination-sm pull-right" sd:pagination="full">

                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal inmodal" id="createModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated bounceInRight">

            <input type="hidden" id="sourceId">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                        class="sr-only">关闭</span>
                </button>
                <h3 style="text-align: left" id="modalTitle"></h3>

            </div>
            <form class="form-horizontal m-t" id="frm">
                <div class="modal-body">

                    <div class="form-group">
                        <label class="col-sm-3 control-label"><span class="required-sign">*</span>名称</label>
                        <div class="col-sm-6">
                            <input class="form-control" name="tagName" maxlength="20">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label"><span class="required-sign">*</span>等级</label>
                        <div class="col-sm-6">
                            <input class="form-control digit" type="number" name="tagLevel">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label"><span class="required-sign">*</span>排序</label>
                        <div class="col-sm-6">
                            <input class="form-control digit" type="number" name="sort">
                        </div>
                    </div>


                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="refuseDo()">保存</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script type="text/template" id='ognTagTmpl'>
    <div class="col-sm-2" style="margin-bottom: 20px">
        <input name="id" type="hidden" value=${id} >
        <input name="tagName" type="hidden" value=${tagName}>
        <input name="ognFlag" value=true type="hidden">
        <span class="label ogn-tag">${tagName}</span>
        <a href="javascript:void(0);" onclick="removeTag(this)" value=${id}><span class="glyphicon glyphicon-remove"
                                                                                  aria-hidden="true"></span></a>
    </div>
</script>
<script type="text/template" id='constantTagTmpl'>
    <div class="col-sm-2" style="margin-bottom: 20px">
        <input name="id" type="hidden" value=${id}>
        <input name="tagName" type="hidden" value=${tagName}>
        <span class="label constant-tag">${tagName}</span>
    </div>
</script>
<script th:replace="~{fragments/scripts}"></script>
<script th:src="@{/js/jquery.tmpl.min.js}"></script>
<script th:inline="javascript">
    /**
     * 新增课程标签
     */
    function createTagBox() {
        var catalogId=$("#catalogId").val()
        var tagName = $('#createTag').val()
        if (catalogId == "" || catalogId == undefined) {
            toastr.error("请选择类目")
            return
        }
        if (tagName == "" || tagName == undefined) {
            toastr.error("请填写标签名")
            return
        }
        $.ajax({
            type:"GET",
            url:"/auth/constantTag/createOgnTag?"+"catalogId="+catalogId+"&tagName="+tagName,
            success:function (data) {
                if(data.success){
                    var tag = [{id:"",tagName: data.result}]
                    $("#createTagBox").append($("#ognTagTmpl").tmpl(tag));
                }
            }
        })


    }
    /**
     * 删除标签
     * @param ele
     */
    function removeTag(ele) {
        var id=$(ele).attr("value")
        if(id){
            $.ajax({
                type:"GET",
                url:"/auth/constantTag/deleteTag/"+id,
                success:function (data) {
                    if(data.success){
                        $(ele).parent().remove();
                    }
                }
            })

        }

    }

    function findTags(){
        var catalogId=$("#catalogId").val()
        if(catalogId==""||catalogId==undefined){
            return
        }
        $.ajax({
            type:"GET",
            url:"/auth/constantTag/findTags?"+"catalogId="+catalogId,
            success:function (data) {
                if(data.success){
                    //公用标签
                    var constantTag=data.result.constantTag
                    $("#constantTagBox").html($("#constantTagTmpl").tmpl(constantTag))
                    //私有标签
                    var ognTag=data.result.ognTag
                    $("#createTagBox").html($("#ognTagTmpl").tmpl(ognTag))



                }
            }
        })
    }

    function deleteBox(id) {
        layer_confirm("确认删除该标签？", 3, delDo, id)
    }
    function delDo(id) {
        $.ajax({
            type: "GET",
            url: "/auth/constantTag/deleteTag/" + id,
            success: function (data) {
                if (data.success) {
                    toastr_success(null, document.location.href);
                } else {
                    toastr.error(data.errorDescription);
                }
            },
            error: function (XMLHttpRequest) {
                toastr_error_system(XMLHttpRequest.status);
            }
        })
    }
    function createInit(title) {
        $("#createModal").modal("show")
        $("#modalTitle").text(title)
    }
    $(function () {
        $(".digit").on("blur", function () {
            $(this).val(parseInt($(this).val()))
        })
    })
</script>
</body>
</html>